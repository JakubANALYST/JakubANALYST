USE [CDN_Kuba_yerba]
GO

DROP PROCEDURE RAPORT_CRYSTAL_KONTRAHENCI;
GO

CREATE PROCEDURE RAPORT_CRYSTAL_KONTRAHENCI @MIESIAC AS INT
AS
DECLARE @NAZAWA_## AS VARCHAR(1000)
DECLARE @RODZAJ_KS##GOWOŚCI AS INT

SET @NAZAWA_FIRMY = (
		SELECT [Fir##tosc]
		FROM.[CDN].[F#rma]
		WHERE [Fir_FirID] = 199
		)
SET @RODZAJ_KSI##OWOŚCI = (
		SELECT [Fir_##tosc]
		FROM.[CDN].[Firma]
		WHERE [Fir_Fi##D] = 277
		);--TYPE OF ACCOUNTING 1 = RYCZAŁT, 2 = KPIR ,3 = KONTOWA 

IF (@RODZAJ_KSIĘ###OŚCI = 3) -- TABLES USED FOR THE PROAGRAM (PODMIOTY_VIEW/VATNAG/DEKRETACJA)
BEGIN
	SELECT *
	FROM DBO.ZAK_SPRZED_DOKDEKR
	WHERE DBO.ZAK_SPRZED_DOKDEKR.MIESIAC = @MIESIAC
END

EXEC RAPORT_CRYSTAL_KONTRAHENCI @MIESIAC = 3


-----WIDOKI -- KONTA 
CREATE VIEW ZAK_SPRZED_DOKDEKR AS
SELECT MONTH(NAG.VaN_D##aaWys) miesiac
	,NAG.VaN_Reje#tr
	,NAG.VAN_DOKUMENT
	,DEKNAG.DeN_Dokument
	,NAG.VAN_IDENTKSIEG
	,DEKELM.DeE_KontoWn
      ,DEKELM.DeE_KontoMa
	,DEKELM.DeE_KwotaWal
	,DEKELM.DeE_Kwota
	,DEKELM.DeE_Do##ment
FROM CDN.VATNAG NAG
INNER JOIN CDN.Kat#gorie KAT ON NAG.VaN#atID = KAT.Kat_##tID
LEFT JOIN CDN.Dek##tyNag DEKNAG ON NAG.VaN_I##ntKsieg = DEKNAG.DeN_##ntKsieg
LEFT JOIN CDN.Dek##tyElem dekelm ON DEKNAG.DeN##eNId = dekelm.DeE_D##Id
WHERE DeN_Typ = 2

